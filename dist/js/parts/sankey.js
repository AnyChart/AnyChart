if(!_.sankey){_.sankey=1;(function($){var YS=function(a,b){$.U.call(this);this.Ca=a;this.qe=b;this.fb=null;var c={};$.R(c,[["fill",0,8192],["stroke",0,8192],["labels",0,0]]);this.ca=new $.cy(this,c,$.bm);$.W(this,"normal",this.ca);this.ca.ra("labelsFactoryConstructor",$.dy);this.ca.ra("labelsAfterInitCallback",$.iy);this.wa=new $.cy(this,c,$.so);$.W(this,"hovered",this.wa);this.wa.ra("labelsFactoryConstructor",$.ey);this.wa.ra("labelsAfterInitCallback",function(a){a.I(4294967295)})},ZS=function(a,b){$.mx.call(this);this.Fa("sankey");
$.ku(this,this,this.zf,this.cg,null,this.zf,null,null);$.R(this.ua,pfa);this.data(a||null,b);this.YQ=(0,$.pa)(this.YQ,this);this.WQ=(0,$.pa)(this.WQ,this)},$S=function(a,b){for(var c=b.MD,d=0;d<c.length;d++){var e=c[d];b.level>=e.level&&(e.level=b.level+1,$S(a,e));e.level>a.G&&(a.G=e.level)}},bT=function(a,b){return b?(a.df[b]||(a.df[b]={type:aT,name:b,level:0,FM:0,EN:0,kG:0,mH:[],MD:[],g2:[],E3:[],t0:[],Zoa:[],ipa:[],sy:[],Hy:[],DR:!1}),a.df[b]):null},dT=function(a,b){var c=b.type,d;if(c==aT){var e=
b.name;a.isConflict={value:b.DR,type:"string"};var f=[];for(d=0;d<b.mH.length;d++){var h=b.mH[d];var k=$.xa(h.MD,function(a){return a==b});f.push({name:h.name,value:h.E3[k]})}a.income={value:f,type:""};f=[];for(d=0;d<b.MD.length;d++)h=b.MD[d],k=$.xa(h.mH,function(a){return a==b}),f.push({name:h.name,value:h.g2[k]});a.outcome={value:f,type:""};a.dropoff={value:b.kG,type:"number"}}else e=c==cT?b.from.name+" -> "+b.ef.name:b.from.name+" dropoff";a.type={value:qfa[c],type:"string"};a.name={value:e,type:"string"};
a.value={value:b.weight,type:"number"}},eT=function(a,b,c){c=c?a.node().lb().labels():a.node().Pa().labels();a=a.node().Pa().labels();c=c.g("position");a=a.g("position");a=$.Fk(c||a,"center");var d=c=0,e=(b.Bj+b.hi)/2,f=(b.xe+b.Me)/2;switch(a){case "left-top":c=b.Bj;d=b.xe;break;case "left-center":c=b.Bj;d=f;break;case "left-bottom":c=b.Bj;d=b.Me;break;case "center-top":c=e;d=b.xe;break;case "center":c=e;d=f;break;case "center-bottom":c=e;d=b.Me;break;case "right-top":c=b.hi;d=b.xe;break;case "right-center":c=
b.hi;d=f;break;case "right-bottom":c=b.hi,d=b.Me}return{value:{x:c,y:d}}},gT=function(a,b,c,d,e,f){for(var h,k,l=0;l<b.length;l++)h=b[l],k=h.path,fT(a,a.b,k.tag,k,d),h.label.gl(c),h.label.wc({value:e(h,f)}),a.je(a.b,h,d)},fT=function(a,b,c,d,e){c=a.Fe(c);a=b.Pm(e,c);b=b.$j(e,c);d.fill(a);d.stroke(b)},hT=function(a,b,c,d,e,f){var h=b.tag;fT(a,a.f,h,b,c);b=h.element;gT(a,b.sy,d,c,f,"leftTop");gT(a,b.Hy,e,c,f,"rightTop");b.label.wc(eT(a,b,c));a.je(a.f,b,c)},iT=function(a,b,c){b=b.tag;var d=b.element;
fT(a,a.b,b,d.path,c);d.label.gl("center-bottom");d.label.wc({value:a.IX(d)});fT(a,a.f,d.from.path.tag,d.from.path,c);fT(a,a.f,d.ef.path.tag,d.ef.path,c);a.je(a.b,d,c)},jT=function(a,b,c){var d=b.tag;fT(a,a.j,d,b,c);a.je(a.j,d.element,c)},kT=function(a){return(a.xe+a.Me)/2},rfa=function(a,b){for(var c=0;c<a.i.length;c++)for(var d=a.i[c].df,e=0;e<d.length;e++){var f=d[e];if(f.sy.length){var h=(0,$.Fg)(f.sy,function(a,b){return a+kT(b.from)*b.weight},0,a),k=(0,$.Fg)(f.sy,function(a,b){return a+b.weight},
0,a);h=(h/k-kT(f))*b;f.xe+=h;f.Me+=h}}},sfa=function(a,b){for(var c=a.i.slice(),d=0;d<c.length;d++)for(var e=a.i[d].df,f=0;f<e.length;f++){var h=e[f];if(h.Hy.length){var k=(0,$.Fg)(h.Hy,function(a,b){return a+kT(b.ef)*b.weight},0,a),l=(0,$.Fg)(h.Hy,function(a,b){return a+b.weight},0,a);k=(k/l-kT(h))*b;h.xe+=k;h.Me+=k}}},lT=function(a,b){for(var c=0;c<a.i.length;c++){var d=a.i[c].df.slice(),e=b.top,f=e+b.height,h=d.length,k,l=a.g("nodePadding");d.sort(a.XQ);for(k=0;k<h;++k){var m=d[k];e-=m.xe;0<e&&
(m.xe+=e,m.Me+=e);e=m.Me+l}e=e-l-f;if(0<e)for(m.xe=m.xe-e,m.Me=m.Me-e,e=m.xe,k=h-2;0<=k;--k)m=d[k],e=m.Me+l-e,0<e&&(m.xe-=e,m.Me-=e),e=m.xe}},mT=function(a,b,c){var d;for(d=0;d<b.length;d++){var e=b[d];fT(a,c,e.tag,e,$.bm)}},nT=function(a,b){return new ZS(a,b)};$.H(YS,$.U);$.Dq(YS,["fill","stroke","labels"],"normal");$.g=YS.prototype;$.g.oa=$.U.prototype.oa|28672;$.g.Na=function(){return this.qe};$.g.Fg=function(){$.W(this,"normal",this.ca);$.W(this,"hovered",this.wa)};
$.g.Ra=function(a){this.fb||(this.fb=new $.ow(0),this.fb.$e(),$.W(this,"tooltip",this.fb),this.fb.parent(this.Ca.Ra()),this.fb.Ca(this.Ca));return $.n(a)?(this.fb.N(a),this):this.fb};$.g.rp=function(){this.va(16384)};$.g.Nd=function(){this.va(4096)};$.g.TH=function(){this.ca.labels().I(4294967295);this.wa.labels().I(4294967295)};$.g.Pa=function(a){return $.n(a)?(this.ca.N(a),this):this.ca};$.g.lb=function(a){return $.n(a)?(this.wa.N(a),this):this.wa};$.g.Pm=function(a,b){return this.xp("fill",a,b)};
$.g.$j=function(a,b){return this.xp("stroke",a,b)};$.g.xp=function(a,b,c){a=(b?this.wa:this.ca).g(a)||this.ca.g(a);$.E(a)&&(a=a.call(c,c));return a};$.g.F=function(){var a=YS.u.F.call(this);a.tooltip=this.Ra().F();a.normal=this.ca.F();a.hovered=this.wa.F();return a};$.g.U=function(a,b){YS.u.U.call(this,a,b);"tooltip"in a&&this.Ra().fa(!!b,a.tooltip);this.ca.fa(!!b,a);this.ca.fa(!!b,a.normal);this.wa.fa(!!b,a.hovered)};$.g.R=function(){$.sd(this.fb,this.ca,this.wa);YS.u.R.call(this)};var oT=YS.prototype;
oT.tooltip=oT.Ra;oT.normal=oT.Pa;oT.hovered=oT.lb;$.H(ZS,$.mx);$.zz(ZS,"sankey",["appearance","data","flowlabels","nodelabels"]);ZS.prototype.oa=$.mx.prototype.oa;var pT={};$.nq(pT,[[0,"nodeWidth",$.Wq],[0,"nodePadding",$.wq],[0,"curveFactor",$.Zq]]);$.S(ZS,pT);var pfa=[["nodeWidth",4,1],["nodePadding",4,1],["curveFactor",4,1]];$.g=ZS.prototype;
$.g.data=function(a,b){if($.n(a)){if(a){var c=a.title||a.caption;c&&this.title(c);a.rows&&(a=a.rows)}this.Pf!==a&&(this.Pf=a,$.od(this.ka),$.od(this.Xc),this.rd=null,$.J(a,$.vr)?this.ka=a.Li():this.ka=$.J(a,$.Fr)?a.Xd():(this.Xc=new $.Fr($.A(a)||$.z(a)?a:null,b)).Xd(),$.K(this.ka,this.bd,this),this.B(256),$.gr(this,"sankey","data",1));return this}return this.ka};$.g.bd=function(){this.B(256);$.gr(this,"sankey","data",1)};$.g.Kf=function(){return this.ka.$()};$.g.zc=function(){return this.rd=this.ka.$()};
$.g.$=function(){return this.rd||(this.rd=this.ka.$())};$.g.Na=function(){return"sankey"};
$.g.pb=function(){if($.kr(this,"sankey","data")){this.df={};this.D={};this.G=-1;for(var a=this.$().reset();a.advance();){var b=String(a.get("from"));var c=a.get("to");c=null===c||$.C(c)?null:String(c);var d=$.N(a.get("weight"));var e=!b.length;var f=null!==c&&!c.length;$.ea(d)&&0<d&&!e&&!f&&(b=bT(this,b),e=bT(this,c),c=b,b=e,e=this.$().la(),this.D[e]={type:b?cT:qT,Hh:e,from:c,ef:b,weight:d},c.EN+=d,b?(c.Hy.push(this.D[e]),c.E3.push(d),c.MD.push(b),b.FM+=d,b.g2.push(d),b.mH.push(c),b.sy.push(this.D[e]),
c.level>=b.level&&(b.level=c.level+1,$S(this,b)),b.level>this.G&&(this.G=b.level)):(c.kG+=d,c.t0.push(d)))}this.i=[];this.Aa=!0;for(var h in this.df)d=this.df[h],d.weight=Math.max(d.FM,d.EN),a=d.MD.length+d.t0.length,this.Aa&&!a&&(d.level=this.G),d.mH.length&&a&&(d.DR=d.FM!=d.EN),a=d.level,this.i[a]||(this.i[a]={df:[],weight:0,top:window.NaN}),a=this.i[a],a.df.push(d),a.weight+=d.weight;for(d=h=0;d<this.i.length;d++)for(a=this.i[d],c=0;c<a.df.length;c++)a.df[c].id=h++;this.B(4);$.ir(this,"sankey",
"data")}};$.g.sj=function(){return!this.$().Ib()};$.g.Qe=function(){return[]};$.g.rp=function(){this.Ra().W()};$.g.QF=function(a,b){if(!this.aa||b)this.aa=new $.xw;var c={};dT(c,a);if(a.type!=aT){var d=this.$();d.select(a.Hh);this.aa.gg(d)}else this.aa.gg(null);return $.gv(this.aa,c)};$.g.Jx=function(a){this.Ii||(this.Ii=new $.xw);var b={};a=a.element;dT(b,a);if(a.type!=aT){var c=this.$();c.select(a.Hh);this.Ii.gg(c)}else this.Ii.gg(null);return $.gv(this.Ii,b)};
$.g.Dfa=function(a,b){return{x:a[b].x,y:a[b].y}};$.g.IX=function(a){return{x:(a.left+a.right)/2,y:a.topCenter}};$.g.zf=function(a){var b=a.domTarget,c=b.tag;if(c){var d=c.element.type;d==aT?(d=this.f.Ra(),hT(this,b,$.so,"left-bottom","right-bottom",this.Dfa)):d==cT?(d=this.b.Ra(),iT(this,b,$.so)):(d=this.j.Ra(),jT(this,b,$.so));$.Gw(d,a.clientX,a.clientY,this.Jx(c))}else this.Ra().Ic()};
$.g.cg=function(a){a=a.domTarget;var b=a.tag;this.Ra().Ic();b&&(b=b.element.type,b==aT?hT(this,a,$.bm,"center-bottom","center-bottom",this.IX):b==cT?iT(this,a,$.bm):jT(this,a,$.bm))};$.g.BS=function(a){var b=[];$.X(a,8192)&&b.push("appearance");$.X(a,4096)&&(a=a.target.Na()==aT,b.push(a?"nodelabels":"flowlabels"));$.hr(this,"sankey",b,1)};$.g.zL=function(a){this.j||(this.j=new YS(this,qT),$.W(this,"dropoff",this.j),this.j.Fg(),$.K(this.j,this.BS,this));return $.n(a)?(this.j.N(a),this):this.j};
$.g.PL=function(a){this.b||(this.b=new YS(this,cT),$.W(this,"flow",this.b),this.b.Fg(),$.K(this.b,this.BS,this));return $.n(a)?(this.b.N(a),this):this.b};$.g.node=function(a){this.f||(this.f=new YS(this,aT),$.W(this,"node",this.f),this.f.Fg(),$.K(this.f,this.BS,this));return $.n(a)?(this.f.N(a),this):this.f};
$.g.$b=function(a){if($.J(a,$.Es))return this.Ec($.Es,a),this;if($.J(a,$.Bs))return this.Ec($.Bs,a),this;$.C(a)&&"range"==a.type?this.Ec($.Es):($.C(a)||null==this.Ea)&&this.Ec($.Bs);return $.n(a)?(this.Ea.N(a),this):this.Ea};$.g.Ec=function(a,b){if($.J(this.Ea,a))b&&this.Ea.N(b);else{var c=!!this.Ea;$.od(this.Ea);this.Ea=new a;$.W(this,"palette",this.Ea);this.Ea.yp();b&&this.Ea.N(b);$.K(this.Ea,this.Ff,this);c&&$.gr(this,"sankey","appearance",1)}};
$.g.Ff=function(a){$.X(a,2)&&$.gr(this,"sankey","appearance",1)};$.g.Fe=function(a){var b=a.element;a=a.element.type;var c=this.$b();return a==aT?{id:b.id,name:b.name,sourceColor:c.oc(b.id),conflict:b.DR}:a==cT?{from:b.from.name,to:b.ef.name,sourceColor:c.oc(b.from.id)}:{from:b.from.name,sourceColor:c.oc(b.from.id)}};var aT=0,cT=1,qT=2,qfa={0:"node",1:"flow",2:"dropoff"};$.g=ZS.prototype;$.g.WQ=function(a,b){return this.XQ(a.from,b.from)};$.g.YQ=function(a,b){return this.XQ(a.ef,b.ef)};
$.g.XQ=function(a,b){return a.xe-b.xe};$.g.CU=function(a,b){return function(c){return a*(1-c)+b*c}};
$.g.Kh=function(a){if(!this.kf()){this.pb();this.xa||(this.xa=this.Ma.Ad(),this.xa.zIndex(30),this.node(),this.PL(),this.zL());if(this.J(4)){this.xa.Wi();this.f.labels().B(2);this.b.labels().B(2);this.j.labels().B(2);this.K=[];this.ba=[];this.P=[];this.da=[];var b=this.g("nodePadding"),c=this.g("nodeWidth");if(this.i.length){var d=this.i.length;var e=a.width/d;c=$.M(c,e);e=.3*c}else c=e=d=0;var f,h=[];for(f=0;f<this.i.length;f++){var k=this.i[f];var l=k.df;var m=l[l.length-1].kG?e:0;l=(a.height-m-
b*(l.length-1))/k.weight;h.push(l)}this.ma=Math.min.apply(null,h);b=(a.width-c)/(d-1);for(f=0;f<this.i.length;f++)for(k=this.i[f],l=k.df,k=0;k<l.length;k++)d=l[k],d.Bj=a.left+d.level*b,d.hi=d.Bj+c,d.xe=a.top+k,d.Me=d.xe+d.weight*this.ma;for(var p in this.D)l=this.D[p],l.height=l.weight*this.ma;lT(this,a);l=1;for(f=32;0<f;--f)l*=.99,sfa(this,l),lT(this,a),rfa(this,l),lT(this,a);for(v in this.df)d=this.df[v],d.Hy.sort(this.YQ),d.sy.sort(this.WQ);for(v in this.df){d=this.df[v];var q=b=d.xe;for(f=0;f<
d.Hy.length;f++)l=d.Hy[f],l.xe=q+l.height/2,q+=l.height;for(f=0;f<d.sy.length;f++)l=d.sy[f],l.Me=b+l.height/2,b+=l.height}for(v in this.df)d=this.df[v],k=this.xa.path(),k.zIndex(3),this.ba.push(k),k.tag={element:d},d.path=k,d.Bj=$.O($.Tm(d.Bj,4),1),d.xe=$.O($.Tm(d.xe,4),1),d.hi=$.O($.Tm(d.hi,4),1),d.Me=$.O($.Tm(d.Me,4),1),k.moveTo(d.Bj,d.xe).lineTo(d.hi,d.xe).lineTo(d.hi,d.Me).lineTo(d.Bj,d.Me).lineTo(d.Bj,d.xe).close();d=this.g("curveFactor");for(p in this.D)if(l=this.D[p],l.ef){k=this.xa.path();
k.zIndex(1);this.P.push(k);k.tag={element:l};l.path=k;a=l.from.hi;f=l.ef.Bj;q=l.xe;b=l.Me;m=this.CU(a,f);h=m(d);m=m(1-d);var r=l.height/2;l.left=a;l.right=f;l.topCenter=(q+b)/2-r;l.leftTop={x:a,y:q-r};l.rightTop={x:f,y:b-r};var t=q-r,u=b-r;q+=r;b+=r;k.moveTo(a,t).Kk(h,t,m,u,f,u).lineTo(f,b).Kk(m,b,h,q,a,q).lineTo(a,t);3>l.height&&(k=this.xa.path(),k.zIndex(2),this.da.push(k),k.fill($.Xl).stroke($.Xl,3),k.moveTo(a,t).Kk(h,t,m,u,f,u).lineTo(f,b).Kk(m,b,h,q,a,q).lineTo(a,t),k.tag={element:l})}else b=
l.from.kG*this.ma,m=Math.min(b,c/4),a=l.from.hi,f=a+m,h=l.from.Me,b=h-b,k=this.xa.path(),k.zIndex(1),this.K.push(k),k.tag={element:l},l.path=k,l.Oia=f,l.Pia=h,k.moveTo(a,b).arcTo(m,m,-90,90),b+m<h&&k.lineTo(f,h),k.lineTo((a+f)/2,h+e).lineTo(a,h).close();$.hr(this,"sankey",["appearance","nodelabels","flowlabels"]);this.I(4)}$.kr(this,"sankey","appearance")&&(mT(this,this.ba,this.f),mT(this,this.P,this.b),mT(this,this.K,this.j),$.ir(this,"sankey","appearance"));if($.kr(this,"sankey","nodelabels")){l=
this.f.labels();l.clear().O(this.xa).zIndex(3);for(var v in this.df)d=this.df[v],a=d.id,c=this.QF(d,!0),e=eT(this,d,$.bm),d.label=l.add(c,e,a),this.je(this.f,d,$.bm);l.W();this.f.TH();$.ir(this,"sankey","nodelabels")}if($.kr(this,"sankey","flowlabels")){v=this.b.labels();f=this.j.labels();v.clear().O(this.xa).zIndex(3);f.clear().O(this.xa).zIndex(3);for(p in this.D)l=this.D[p],a=$.N(p),d=l.ef,c=this.QF(l,!0),d?(e={value:this.IX(l)},l.label=v.add(c,e,a),l.label.gl("center-bottom")):(e={value:{x:l.Oia,
y:l.Pia}},l.label=f.add(c,e,a),l.label.gl("left-center")),this.je(d?this.b:this.j,l,$.bm);v.W();f.W();this.b.TH();this.j.TH();$.ir(this,"sankey","flowlabels")}}};
$.g.je=function(a,b,c){var d=b.label;if(d){var e=this.$();a.Na()==aT?e.reset():e.select(b.Hh);b=e.get("normal");b=$.n(b)?b.label:void 0;var f=e.get("hovered");f=$.n(f)?f.label:void 0;b=$.Wo(b,e.get("label"),null);e=$.Wo(f,e.get("hoverLabel"),null);e=c?e:null;f=c?a.lb().labels():null;var h=a.Pa().labels();c=c?a.lb().labels().na:null;var k=a.Pa().labels().na,l=e&&$.n(e.enabled)?e.enabled:null,m=b&&$.n(b.enabled)?b.enabled:null,p=f&&null!==f.enabled()?f.enabled():null,q=h&&null!==h.enabled()?h.enabled():
null;a=!1;null!=l?a=l:null!=m?a=m:null!=p?a=p:a=q;a?(d.enabled(!0),d.state("labelOwnSettings",d.Oa,0),d.state("pointState",e,1),d.state("pointNormal",b,2),d.state("elementState",f,3),d.state("elementNormal",h,4),d.state("elementStateTheme",c,5),d.state("auto",d.Jd,6),d.state("elementNormalTheme",k,7)):d.enabled(!1);d.W()}};$.g.ns=function(){return[this]};$.g.QC=function(){return["from","to","weight"]};
$.g.F=function(){var a=ZS.u.F.call(this);a.data=this.data().F();a.tooltip=this.Ra().F();a.palette=this.$b().F();a.dropoff=this.zL().F();a.flow=this.PL().F();a.node=this.node().F();$.Nq(this,pT,a);return{chart:a}};$.g.U=function(a,b){ZS.u.U.call(this,a,b);"data"in a&&this.data(a.data);this.$b(a.palette);"tooltip"in a&&this.Ra().fa(!!b,a.tooltip);"dropoff"in a&&this.zL().fa(!!b,a.dropoff);"flow"in a&&this.PL().fa(!!b,a.flow);"node"in a&&this.node().fa(!!b,a.node);$.Fq(this,pT,a,b)};
$.g.R=function(){$.sd(this.Ea,this.j,this.b,this.f,this.fb,this.K,this.ba,this.P,this.da,this.ka,this.Xc);this.fb=this.f=this.b=this.j=this.Ea=null;this.K.length=0;this.ba.length=0;this.P.length=0;this.da.length=0;this.rd=this.Xc=this.ka=null;ZS.u.R.call(this)};var rT=ZS.prototype;rT.getType=rT.Na;rT.data=rT.data;rT.noData=rT.zm;rT.tooltip=rT.Ra;rT.dropoff=rT.zL;rT.flow=rT.PL;rT.node=rT.node;rT.palette=rT.$b;$.Op.sankey=nT;$.F("anychart.sankey",nT);}).call(this,$)}
