if(!_.sankey){_.sankey=1;(function($){var dfa=function(a,b){return a|(this.HH[b]||0)},ZO=function(a,b,c){$.Kp(a,"sankey")&&(b=(0,$.$f)(b,dfa,0,a.tu.sankey)&~a.Po.sankey,a.Po.sankey|=b,(b||a.Sm())&&a.ta(c||0))},$O=function(a,b){$.Hp.call(this);this.xa=a;this.ed=b;this.pb=null;var c={};$.R(c,[["fill",0,8192],["stroke",0,8192],["labels",0,0]]);this.ia=new $.Ov(this,c,$.Qk);this.ia.ca.labelsFactoryConstructor=$.Qv;this.ia.ca.labelsAfterInitCallback=$.Tv;this.Aa=new $.Ov(this,c,1);this.Aa.ca.labelsFactoryConstructor=$.Qv;$.Ip(this.Aa,"labelsAfterInitCallback",
function(a){a.I(4294967295)})},aP=function(a,b){$.qv.call(this);$.rs(this,this,this.Uf,this.Ag,null,this.Uf,null,null);$.R(this.ya,efa);this.data(a||null,b);this.dP=(0,$.oa)(this.dP,this);this.bP=(0,$.oa)(this.bP,this)},bP=function(a,b){for(var c=b.CC,d=0;d<c.length;d++){var e=c[d];b.level>=e.level&&(e.level=b.level+1,bP(a,e));e.level>a.G&&(a.G=e.level)}},dP=function(a,b){return b?(a.Dg[b]||(a.Dg[b]={type:cP,name:b,level:0,PK:0,LL:0,kF:0,iG:[],CC:[],UZ:[],p0:[],rY:[],wla:[],Cla:[],jx:[],Ax:[],CP:!1}),
a.Dg[b]):null},fP=function(a,b){var c=b.type,d;if(c==cP){var e=b.name;a.isConflict={value:b.CP,type:"string"};var f=[];for(d=0;d<b.iG.length;d++){var h=b.iG[d];var k=$.ta(h.CC,function(a){return a==b});f.push({name:h.name,value:h.p0[k]})}a.income={value:f,type:""};f=[];for(d=0;d<b.CC.length;d++)h=b.CC[d],k=$.ta(h.iG,function(a){return a==b}),f.push({name:h.name,value:h.UZ[k]});a.outcome={value:f,type:""};a.dropoff={value:b.kF,type:"number"}}else e=c==eP?b.from.name+" -> "+b.kg.name:b.from.name+" dropoff";
a.type={value:ffa[c],type:"string"};a.name={value:e,type:"string"};a.value={value:b.weight,type:"number"}},gP=function(a,b,c){c=c?a.node().jb().labels():a.node().Oa().labels();a=a.node().Oa().labels();c=c.i("position");a=a.i("position");a=$.jj(c||a,"center");var d=c=0,e=(b.Hj+b.Ij)/2,f=(b.pe+b.Ze)/2;switch(a){case "left-top":c=b.Hj;d=b.pe;break;case "left-center":c=b.Hj;d=f;break;case "left-bottom":c=b.Hj;d=b.Ze;break;case "center-top":c=e;d=b.pe;break;case "center":c=e;d=f;break;case "center-bottom":c=
e;d=b.Ze;break;case "right-top":c=b.Ij;d=b.pe;break;case "right-center":c=b.Ij;d=f;break;case "right-bottom":c=b.Ij,d=b.Ze}return{value:{x:c,y:d}}},iP=function(a,b,c,d,e,f){for(var h,k,l=0;l<b.length;l++)h=b[l],k=h.path,hP(a,a.f,k.tag,k,d),h.label.nk(c),h.label.vc({value:e(h,f)}),a.Kd(a.f,h,d)},hP=function(a,b,c,d,e){c=a.Je(c);a=b.eo(e,c);b=b.hp(e,c);d.fill(a);d.stroke(b)},jP=function(a,b,c,d,e,f){var h=b.tag;hP(a,a.g,h,b,c);b=h.element;iP(a,b.jx,d,c,f,"leftTop");iP(a,b.Ax,e,c,f,"rightTop");b.label.vc(gP(a,
b,c));a.Kd(a.g,b,c)},kP=function(a,b,c){b=b.tag;var d=b.element;hP(a,a.f,b,d.path,c);d.label.nk("center-bottom");d.label.vc({value:a.fV(d)});hP(a,a.g,d.from.path.tag,d.from.path,c);hP(a,a.g,d.kg.path.tag,d.kg.path,c);a.Kd(a.f,d,c)},lP=function(a,b,c){var d=b.tag;hP(a,a.o,d,b,c);a.Kd(a.o,d.element,c)},mP=function(a){return(a.pe+a.Ze)/2},gfa=function(a,b){for(var c=0;c<a.b.length;c++)for(var d=a.b[c].Dg,e=0;e<d.length;e++){var f=d[e];if(f.jx.length){var h=(0,$.$f)(f.jx,function(a,b){return a+mP(b.from)*
b.weight},0,a),k=(0,$.$f)(f.jx,function(a,b){return a+b.weight},0,a);h=(h/k-mP(f))*b;f.pe+=h;f.Ze+=h}}},hfa=function(a,b){for(var c=a.b.slice(),d=0;d<c.length;d++)for(var e=a.b[d].Dg,f=0;f<e.length;f++){var h=e[f];if(h.Ax.length){var k=(0,$.$f)(h.Ax,function(a,b){return a+mP(b.kg)*b.weight},0,a),l=(0,$.$f)(h.Ax,function(a,b){return a+b.weight},0,a);k=(k/l-mP(h))*b;h.pe+=k;h.Ze+=k}}},nP=function(a,b){for(var c=0;c<a.b.length;c++){var d=a.b[c].Dg.slice(),e=b.top,f=e+b.height,h=d.length,k,l=a.i("nodePadding");
d.sort(a.cP);for(k=0;k<h;++k){var m=d[k];e-=m.pe;0<e&&(m.pe+=e,m.Ze+=e);e=m.Ze+l}e=e-l-f;if(0<e)for(m.pe=m.pe-e,m.Ze=m.Ze-e,e=m.pe,k=h-2;0<=k;--k)m=d[k],e=m.Ze+l-e,0<e&&(m.pe-=e,m.Ze-=e),e=m.pe}},oP=function(a,b,c){var d;for(d=0;d<b.length;d++){var e=b[d];hP(a,c,e.tag,e,$.Qk)}},pP=function(a,b){var c=new aP(a,b);c.ea(!0,$.Xk("sankey"));return c};$.I($O,$.Hp);$.bp($O,["fill","stroke","labels"],"normal");$.g=$O.prototype;$.g.ra=$.Hp.prototype.ra|28672;$.g.Ra=function(){return this.ed};
$.g.ab=function(a){this.pb||(this.pb=new $.tu(0),this.pb.Ud(),this.pb.parent(this.xa.ab()),this.pb.xa(this.xa));return $.n(a)?(this.pb.N(a),this):this.pb};$.g.xo=function(){this.ta(16384)};$.g.ce=function(){this.ta(4096)};$.g.MG=function(){this.ia.labels().I(4294967295);this.Aa.labels().I(4294967295)};$.g.Oa=function(a){return $.n(a)?(this.ia.N(a),this):this.ia};$.g.jb=function(a){return $.n(a)?(this.Aa.N(a),this):this.Aa};$.g.eo=function(a,b){return this.Mx("fill",a,b)};
$.g.hp=function(a,b){return this.Mx("stroke",a,b)};$.g.Mx=function(a,b,c){a=(b?this.Aa:this.ia).i(a)||this.ia.i(a);$.F(a)&&(a=a.call(c,c));return a};$.g.F=function(){var a=$O.B.F.call(this);a.tooltip=this.ab().F();a.normal=this.ia.F();a.hovered=this.Aa.F();return a};$.g.$=function(a,b){$O.B.$.call(this,a,b);"tooltip"in a&&this.ab().ea(!!b,a.tooltip);this.ia.ea(!!b,a);this.ia.ea(!!b,a.normal);this.Aa.ea(!!b,a.hovered)};$.g.R=function(){$.bd(this.pb,this.ia,this.Aa);$O.B.R.call(this)};var qP=$O.prototype;
qP.tooltip=qP.ab;qP.normal=qP.Oa;qP.hovered=qP.jb;$.I(aP,$.qv);$.bx(aP,"sankey",["appearance","data","flowlabels","nodelabels"]);aP.prototype.ra=$.qv.prototype.ra;var rP={};$.Po(rP,[[0,"nodeWidth",$.zp],[0,"nodePadding",$.Xo],[0,"curveFactor",$.Cp]]);$.T(aP,rP);var efa=[["nodeWidth",4,1],["nodePadding",4,1],["curveFactor",4,1]];$.g=aP.prototype;
$.g.data=function(a,b){if($.n(a)){if(a){var c=a.title||a.caption;c&&this.title(c);a.rows&&(a=a.rows)}this.Nf!==a&&(this.Nf=a,$.$c(this.qa),this.Xe=null,$.L(a,$.$p)?this.qa=a.zl():this.qa=$.L(a,$.jq)?a.me():(new $.jq($.D(a)||$.z(a)?a:null,b)).me(),$.U(this.qa,this.Td,this),this.u(256),$.Lp(this,"sankey","data",1));return this}return this.qa};$.g.Td=function(){this.u(256);$.Lp(this,"sankey","data",1)};$.g.Df=function(){return this.qa.aa()};$.g.uc=function(){return this.Xe=this.qa.aa()};
$.g.aa=function(){return this.Xe||(this.Xe=this.qa.aa())};$.g.Ra=function(){return"sankey"};
$.g.lb=function(){if($.Np(this,"sankey","data")){this.Dg={};this.D={};this.G=-1;for(var a=this.aa().reset();a.advance();){var b=String(a.get("from"));var c=a.get("to");c=null===c||$.E(c)?null:String(c);var d=$.O(a.get("weight"));var e=!b.length;var f=null!==c&&!c.length;$.B(d)&&0<d&&!e&&!f&&(b=dP(this,b),e=dP(this,c),c=b,b=e,e=this.aa().ka(),this.D[e]={type:b?eP:sP,ki:e,from:c,kg:b,weight:d},c.LL+=d,b?(c.Ax.push(this.D[e]),c.p0.push(d),c.CC.push(b),b.PK+=d,b.UZ.push(d),b.iG.push(c),b.jx.push(this.D[e]),
c.level>=b.level&&(b.level=c.level+1,bP(this,b)),b.level>this.G&&(this.G=b.level)):(c.kF+=d,c.rY.push(d)))}this.b=[];this.va=!0;for(var h in this.Dg)d=this.Dg[h],d.weight=Math.max(d.PK,d.LL),a=d.CC.length+d.rY.length,this.va&&!a&&(d.level=this.G),d.iG.length&&a&&(d.CP=d.PK!=d.LL),a=d.level,this.b[a]||(this.b[a]={Dg:[],weight:0,top:window.NaN}),a=this.b[a],a.Dg.push(d),a.weight+=d.weight;for(d=h=0;d<this.b.length;d++)for(a=this.b[d],c=0;c<a.Dg.length;c++)a.Dg[c].id=h++;this.u(4);$.Mp(this,"sankey",
"data")}};$.g.cj=function(){return!this.aa().Nb()};$.g.Ie=function(){return[]};$.g.xo=function(){this.ab().Y()};$.g.LE=function(a,b){if(!this.K||b)this.K=new $.Cu;var c={};fP(c,a);if(a.type!=cP){var d=this.aa();d.select(a.ki);this.K.ng(d)}else this.K.ng(null);return $.nt(this.K,c)};$.g.KP=function(a){this.Wk||(this.Wk=new $.Cu);var b={};a=a.element;fP(b,a);if(a.type!=cP){var c=this.aa();c.select(a.ki);this.Wk.ng(c)}else this.Wk.ng(null);return $.nt(this.Wk,b)};
$.g.qca=function(a,b){return{x:a[b].x,y:a[b].y}};$.g.fV=function(a){return{x:(a.left+a.right)/2,y:a.topCenter}};$.g.Uf=function(a){var b=a.domTarget,c=b.tag;if(c){var d=c.element.type;d==cP?(d=this.g.ab(),jP(this,b,1,"left-bottom","right-bottom",this.qca)):d==eP?(d=this.f.ab(),kP(this,b,1)):(d=this.o.ab(),lP(this,b,1));$.Lu(d,a.clientX,a.clientY,this.KP(c))}else this.ab().gd()};
$.g.Ag=function(a){a=a.domTarget;var b=a.tag;this.ab().gd();b&&(b=b.element.type,b==cP?jP(this,a,$.Qk,"center-bottom","center-bottom",this.fV):b==eP?kP(this,a,$.Qk):lP(this,a,$.Qk))};$.g.AQ=function(a){var b=[];$.W(a,8192)&&b.push("appearance");$.W(a,4096)&&(a=a.target.Ra()==cP,b.push(a?"nodelabels":"flowlabels"));ZO(this,b,1)};$.g.yQ=function(a){this.o||(this.o=new $O(this,sP),$.U(this.o,this.AQ,this));return $.n(a)?(this.o.N(a),this):this.o};
$.g.MQ=function(a){this.f||(this.f=new $O(this,eP),$.U(this.f,this.AQ,this));return $.n(a)?(this.f.N(a),this):this.f};$.g.node=function(a){this.g||(this.g=new $O(this,cP),$.U(this.g,this.AQ,this));return $.n(a)?(this.g.N(a),this):this.g};$.g.Yb=function(a){if($.L(a,$.gr))return this.Ic($.gr,a),this;if($.L(a,$.dr))return this.Ic($.dr,a),this;$.E(a)&&"range"==a.type?this.Ic($.gr):($.E(a)||null==this.Ba)&&this.Ic($.dr);return $.n(a)?(this.Ba.N(a),this):this.Ba};
$.g.Ic=function(a,b){if($.L(this.Ba,a))b&&this.Ba.N(b);else{var c=!!this.Ba;$.$c(this.Ba);this.Ba=new a;$.Tp(this,"palette",this.Ba);this.Ba.Jq();b&&this.Ba.N(b);$.U(this.Ba,this.Ef,this);c&&$.Lp(this,"sankey","appearance",1)}};$.g.Ef=function(a){$.W(a,2)&&$.Lp(this,"sankey","appearance",1)};
$.g.Je=function(a){var b=a.element;a=a.element.type;var c=this.Yb();return a==cP?{id:b.id,name:b.name,sourceColor:c.jc(b.id),conflict:b.CP}:a==eP?{from:b.from.name,to:b.kg.name,sourceColor:c.jc(b.from.id)}:{from:b.from.name,sourceColor:c.jc(b.from.id)}};var cP=0,eP=1,sP=2,ffa={0:"node",1:"flow",2:"dropoff"};$.g=aP.prototype;$.g.bP=function(a,b){return this.cP(a.from,b.from)};$.g.dP=function(a,b){return this.cP(a.kg,b.kg)};$.g.cP=function(a,b){return a.pe-b.pe};
$.g.rS=function(a,b){return function(c){return a*(1-c)+b*c}};
$.g.Ui=function(a){if(!this.Lf()){this.lb();this.wa||(this.wa=this.Va.ke(),this.wa.zIndex(30));if(this.J(4)){this.wa.wi();this.g.labels().u(2);this.f.labels().u(2);this.o.labels().u(2);this.P=[];this.fa=[];this.W=[];this.na=[];var b=this.i("nodePadding"),c=this.i("nodeWidth");if(this.b.length){var d=this.b.length;var e=a.width/d;c=$.N(c,e);e=.3*c}else c=e=d=0;var f,h=[];for(f=0;f<this.b.length;f++){var k=this.b[f];var l=k.Dg;var m=l[l.length-1].kF?e:0;l=(a.height-m-b*(l.length-1))/k.weight;h.push(l)}this.la=
Math.min.apply(null,h);b=(a.width-c)/(d-1);for(f=0;f<this.b.length;f++)for(k=this.b[f],l=k.Dg,k=0;k<l.length;k++)d=l[k],d.Hj=a.left+d.level*b,d.Ij=d.Hj+c,d.pe=a.top+k,d.Ze=d.pe+d.weight*this.la;for(var p in this.D)l=this.D[p],l.height=l.weight*this.la;nP(this,a);l=1;for(f=32;0<f;--f)l*=.99,hfa(this,l),nP(this,a),gfa(this,l),nP(this,a);for(v in this.Dg)d=this.Dg[v],d.Ax.sort(this.dP),d.jx.sort(this.bP);for(v in this.Dg){d=this.Dg[v];var q=b=d.pe;for(f=0;f<d.Ax.length;f++)l=d.Ax[f],l.pe=q+l.height/
2,q+=l.height;for(f=0;f<d.jx.length;f++)l=d.jx[f],l.Ze=b+l.height/2,b+=l.height}for(v in this.Dg)d=this.Dg[v],k=this.wa.path(),k.zIndex(3),this.fa.push(k),k.tag={element:d},d.path=k,d.Hj=$.vn($.zl(d.Hj,4),1),d.pe=$.vn($.zl(d.pe,4),1),d.Ij=$.vn($.zl(d.Ij,4),1),d.Ze=$.vn($.zl(d.Ze,4),1),k.moveTo(d.Hj,d.pe).lineTo(d.Ij,d.pe).lineTo(d.Ij,d.Ze).lineTo(d.Hj,d.Ze).lineTo(d.Hj,d.pe).close();d=this.i("curveFactor");for(p in this.D)if(l=this.D[p],l.kg){k=this.wa.path();k.zIndex(1);this.W.push(k);k.tag={element:l};
l.path=k;a=l.from.Ij;f=l.kg.Hj;q=l.pe;b=l.Ze;m=this.rS(a,f);h=m(d);m=m(1-d);var r=l.height/2;l.left=a;l.right=f;l.topCenter=(q+b)/2-r;l.leftTop={x:a,y:q-r};l.rightTop={x:f,y:b-r};var t=q-r,u=b-r;q+=r;b+=r;k.moveTo(a,t).Rj(h,t,m,u,f,u).lineTo(f,b).Rj(m,b,h,q,a,q).lineTo(a,t);3>l.height&&(k=this.wa.path(),k.zIndex(2),this.na.push(k),k.fill($.Lk).stroke($.Lk,3),k.moveTo(a,t).Rj(h,t,m,u,f,u).lineTo(f,b).Rj(m,b,h,q,a,q).lineTo(a,t),k.tag={element:l})}else b=l.from.kF*this.la,m=Math.min(b,c/4),a=l.from.Ij,
f=a+m,h=l.from.Ze,b=h-b,k=this.wa.path(),k.zIndex(1),this.P.push(k),k.tag={element:l},l.path=k,l.Afa=f,l.Bfa=h,k.moveTo(a,b).arcTo(m,m,-90,90),b+m<h&&k.lineTo(f,h),k.lineTo((a+f)/2,h+e).lineTo(a,h).close();ZO(this,["appearance","nodelabels","flowlabels"]);this.I(4)}$.Np(this,"sankey","appearance")&&(oP(this,this.fa,this.g),oP(this,this.W,this.f),oP(this,this.P,this.o),$.Mp(this,"sankey","appearance"));if($.Np(this,"sankey","nodelabels")){l=this.g.labels();l.clear().O(this.wa).zIndex(3);for(var v in this.Dg)d=
this.Dg[v],a=d.id,c=this.LE(d,!0),e=gP(this,d,$.Qk),d.label=l.add(c,e,a),this.Kd(this.g,d,$.Qk);l.Y();this.g.MG();$.Mp(this,"sankey","nodelabels")}if($.Np(this,"sankey","flowlabels")){v=this.f.labels();f=this.o.labels();v.clear().O(this.wa).zIndex(3);f.clear().O(this.wa).zIndex(3);for(p in this.D)l=this.D[p],a=$.O(p),d=l.kg,c=this.LE(l,!0),d?(e={value:this.fV(l)},l.label=v.add(c,e,a),l.label.nk("center-bottom")):(e={value:{x:l.Afa,y:l.Bfa}},l.label=f.add(c,e,a),l.label.nk("left-center")),this.Kd(d?
this.f:this.o,l,$.Qk);v.Y();f.Y();this.f.MG();this.o.MG();$.Mp(this,"sankey","flowlabels")}}};
$.g.Kd=function(a,b,c){var d=b.label;if(d){var e=this.aa();a.Ra()==cP?e.reset():e.select(b.ki);b=e.get("normal");b=$.n(b)?b.label:void 0;var f=e.get("hovered");f=$.n(f)?f.label:void 0;b=$.xn(b,e.get("label"),null);e=$.xn(f,e.get("hoverLabel"),null);e=c?e:null;f=c?a.jb().labels():null;var h=a.Oa().labels();c=c?a.jb().labels().ma:null;var k=a.Oa().labels().ma,l=e&&$.n(e.enabled)?e.enabled:null,m=b&&$.n(b.enabled)?b.enabled:null,p=f&&null!==f.enabled()?f.enabled():null,q=h&&null!==h.enabled()?h.enabled():
null;a=!1;null!=l?a=l:null!=m?a=m:null!=p?a=p:a=q;a?(d.enabled(!0),d.state("labelOwnSettings",d.ca,0),d.state("pointState",e,1),d.state("pointNormal",b,2),d.state("elementState",f,3),d.state("elementNormal",h,4),d.state("elementStateTheme",c,5),d.state("auto",d.nd,6),d.state("elementNormalTheme",k,7)):d.enabled(!1);d.Y()}};$.g.Ru=function(){return[this]};$.g.yF=function(){return["from","to","weight"]};
$.g.F=function(){var a=aP.B.F.call(this);a.data=this.data().F();a.tooltip=this.ab().F();a.palette=this.Yb().F();a.dropoff=this.yQ().F();a.flow=this.MQ().F();a.node=this.node().F();$.pp(this,rP,a);return{chart:a}};$.g.$=function(a,b){aP.B.$.call(this,a,b);"data"in a&&this.data(a.data);this.Yb(a.palette);"tooltip"in a&&this.ab().ea(!!b,a.tooltip);"dropoff"in a&&this.yQ().ea(!!b,a.dropoff);"flow"in a&&this.MQ().ea(!!b,a.flow);"node"in a&&this.node().ea(!!b,a.node);$.dp(this,rP,a,b)};
$.g.R=function(){$.bd(this.Ba,this.o,this.f,this.g,this.pb,this.P,this.fa,this.W,this.na);aP.B.R.call(this)};var tP=aP.prototype;tP.getType=tP.Ra;tP.data=tP.data;tP.noData=tP.Tm;tP.tooltip=tP.ab;tP.dropoff=tP.yQ;tP.flow=tP.MQ;tP.node=tP.node;tP.palette=tP.Yb;$.oo.sankey=pP;$.H("anychart.sankey",pP);}).call(this,$)}
