if(!_.sankey){_.sankey=1;(function($){var bS=function(a,b){$.Mq.call(this);this.Aa=a;this.ie=b;this.cb=null;var c={};$.T(c,[["fill",0,8192],["stroke",0,8192],["labels",0,0]]);this.ba=new $.zx(this,c,$.Vl);$.W(this,"normal",this.ba);this.ba.pa("labelsFactoryConstructor",$.Ax);this.ba.pa("labelsAfterInitCallback",$.Fx);this.wa=new $.zx(this,c,$.fo);$.W(this,"hovered",this.wa);this.wa.pa("labelsFactoryConstructor",$.Bx);this.wa.pa("labelsAfterInitCallback",function(a){a.I(4294967295)})},cS=function(a,b){$.Gw.call(this);this.Fa("sankey");
$.Ft(this,this,this.ng,this.Cg,null,this.ng,null,null);$.T(this.ua,kfa);this.data(a||null,b);this.PP=(0,$.pa)(this.PP,this);this.NP=(0,$.pa)(this.NP,this)},dS=function(a,b){for(var c=b.kD,d=0;d<c.length;d++){var e=c[d];b.level>=e.level&&(e.level=b.level+1,dS(a,e));e.level>a.G&&(a.G=e.level)}},fS=function(a,b){return b?(a.qf[b]||(a.qf[b]={type:eS,name:b,level:0,yL:0,xM:0,FF:0,DG:[],kD:[],E0:[],Z1:[],VZ:[],poa:[],zoa:[],Rx:[],gy:[],qQ:!1}),a.qf[b]):null},hS=function(a,b){var c=b.type,d;if(c==eS){var e=
b.name;a.isConflict={value:b.qQ,type:"string"};var f=[];for(d=0;d<b.DG.length;d++){var h=b.DG[d];var k=$.wa(h.kD,function(a){return a==b});f.push({name:h.name,value:h.Z1[k]})}a.income={value:f,type:""};f=[];for(d=0;d<b.kD.length;d++)h=b.kD[d],k=$.wa(h.DG,function(a){return a==b}),f.push({name:h.name,value:h.E0[k]});a.outcome={value:f,type:""};a.dropoff={value:b.FF,type:"number"}}else e=c==gS?b.from.name+" -> "+b.yf.name:b.from.name+" dropoff";a.type={value:lfa[c],type:"string"};a.name={value:e,type:"string"};
a.value={value:b.weight,type:"number"}},iS=function(a,b,c){c=c?a.node().kb().labels():a.node().Ra().labels();a=a.node().Ra().labels();c=c.i("position");a=a.i("position");a=$.uk(c||a,"center");var d=c=0,e=(b.gj+b.hj)/2,f=(b.pe+b.Xe)/2;switch(a){case "left-top":c=b.gj;d=b.pe;break;case "left-center":c=b.gj;d=f;break;case "left-bottom":c=b.gj;d=b.Xe;break;case "center-top":c=e;d=b.pe;break;case "center":c=e;d=f;break;case "center-bottom":c=e;d=b.Xe;break;case "right-top":c=b.hj;d=b.pe;break;case "right-center":c=
b.hj;d=f;break;case "right-bottom":c=b.hj,d=b.Xe}return{value:{x:c,y:d}}},kS=function(a,b,c,d,e,f){for(var h,k,l=0;l<b.length;l++)h=b[l],k=h.path,jS(a,a.b,k.tag,k,d),h.label.Ok(c),h.label.Ec({value:e(h,f)}),a.Zd(a.b,h,d)},jS=function(a,b,c,d,e){c=a.we(c);a=b.jn(e,c);b=b.Wk(e,c);d.fill(a);d.stroke(b)},lS=function(a,b,c,d,e,f){var h=b.tag;jS(a,a.f,h,b,c);b=h.element;kS(a,b.Rx,d,c,f,"leftTop");kS(a,b.gy,e,c,f,"rightTop");b.label.Ec(iS(a,b,c));a.Zd(a.f,b,c)},mS=function(a,b,c){b=b.tag;var d=b.element;
jS(a,a.b,b,d.path,c);d.label.Ok("center-bottom");d.label.Ec({value:a.sW(d)});jS(a,a.f,d.from.path.tag,d.from.path,c);jS(a,a.f,d.yf.path.tag,d.yf.path,c);a.Zd(a.b,d,c)},nS=function(a,b,c){var d=b.tag;jS(a,a.j,d,b,c);a.Zd(a.j,d.element,c)},oS=function(a){return(a.pe+a.Xe)/2},mfa=function(a,b){for(var c=0;c<a.g.length;c++)for(var d=a.g[c].qf,e=0;e<d.length;e++){var f=d[e];if(f.Rx.length){var h=(0,$.Hg)(f.Rx,function(a,b){return a+oS(b.from)*b.weight},0,a),k=(0,$.Hg)(f.Rx,function(a,b){return a+b.weight},
0,a);h=(h/k-oS(f))*b;f.pe+=h;f.Xe+=h}}},nfa=function(a,b){for(var c=a.g.slice(),d=0;d<c.length;d++)for(var e=a.g[d].qf,f=0;f<e.length;f++){var h=e[f];if(h.gy.length){var k=(0,$.Hg)(h.gy,function(a,b){return a+oS(b.yf)*b.weight},0,a),l=(0,$.Hg)(h.gy,function(a,b){return a+b.weight},0,a);k=(k/l-oS(h))*b;h.pe+=k;h.Xe+=k}}},pS=function(a,b){for(var c=0;c<a.g.length;c++){var d=a.g[c].qf.slice(),e=b.top,f=e+b.height,h=d.length,k,l=a.i("nodePadding");d.sort(a.OP);for(k=0;k<h;++k){var m=d[k];e-=m.pe;0<e&&
(m.pe+=e,m.Xe+=e);e=m.Xe+l}e=e-l-f;if(0<e)for(m.pe=m.pe-e,m.Xe=m.Xe-e,e=m.pe,k=h-2;0<=k;--k)m=d[k],e=m.Xe+l-e,0<e&&(m.pe-=e,m.Xe-=e),e=m.pe}},qS=function(a,b,c){var d;for(d=0;d<b.length;d++){var e=b[d];jS(a,c,e.tag,e,$.Vl)}},rS=function(a,b){return new cS(a,b)};$.H(bS,$.Mq);$.kq(bS,["fill","stroke","labels"],"normal");$.g=bS.prototype;$.g.qa=$.Mq.prototype.qa|28672;$.g.Oa=function(){return this.ie};$.g.pg=function(){$.W(this,"normal",this.ba);$.W(this,"hovered",this.wa)};
$.g.Va=function(a){this.cb||(this.cb=new $.Iv(0),this.cb.Re(),$.W(this,"tooltip",this.cb),this.cb.parent(this.Aa.Va()),this.cb.Aa(this.Aa));return $.n(a)?(this.cb.K(a),this):this.cb};$.g.cp=function(){this.xa(16384)};$.g.Wd=function(){this.xa(4096)};$.g.dH=function(){this.ba.labels().I(4294967295);this.wa.labels().I(4294967295)};$.g.Ra=function(a){return $.n(a)?(this.ba.K(a),this):this.ba};$.g.kb=function(a){return $.n(a)?(this.wa.K(a),this):this.wa};$.g.jn=function(a,b){return this.ty("fill",a,b)};
$.g.Wk=function(a,b){return this.ty("stroke",a,b)};$.g.ty=function(a,b,c){a=(b?this.wa:this.ba).i(a)||this.ba.i(a);$.E(a)&&(a=a.call(c,c));return a};$.g.F=function(){var a=bS.B.F.call(this);a.tooltip=this.Va().F();a.normal=this.ba.F();a.hovered=this.wa.F();return a};$.g.X=function(a,b){bS.B.X.call(this,a,b);"tooltip"in a&&this.Va().ia(!!b,a.tooltip);this.ba.ia(!!b,a);this.ba.ia(!!b,a.normal);this.wa.ia(!!b,a.hovered)};$.g.R=function(){$.od(this.cb,this.ba,this.wa);bS.B.R.call(this)};var sS=bS.prototype;
sS.tooltip=sS.Va;sS.normal=sS.Ra;sS.hovered=sS.kb;$.H(cS,$.Gw);$.Vy(cS,"sankey",["appearance","data","flowlabels","nodelabels"]);cS.prototype.qa=$.Gw.prototype.qa;var tS={};$.Yp(tS,[[0,"nodeWidth",$.Eq],[0,"nodePadding",$.fq],[0,"curveFactor",$.Hq]]);$.U(cS,tS);var kfa=[["nodeWidth",4,1],["nodePadding",4,1],["curveFactor",4,1]];$.g=cS.prototype;
$.g.data=function(a,b){if($.n(a)){if(a){var c=a.title||a.caption;c&&this.title(c);a.rows&&(a=a.rows)}this.dg!==a&&(this.dg=a,$.md(this.na),$.md(this.kd),this.Vd=null,$.K(a,$.er)?this.na=a.ij():this.na=$.K(a,$.or)?a.fe():(this.kd=new $.or($.A(a)||$.z(a)?a:null,b)).fe(),$.L(this.na,this.Fd,this),this.u(256),$.Qq(this,"sankey","data",1));return this}return this.na};$.g.Fd=function(){this.u(256);$.Qq(this,"sankey","data",1)};$.g.Kf=function(){return this.na.aa()};$.g.xc=function(){return this.Vd=this.na.aa()};
$.g.aa=function(){return this.Vd||(this.Vd=this.na.aa())};$.g.Oa=function(){return"sankey"};
$.g.nb=function(){if($.Tq(this,"sankey","data")){this.qf={};this.D={};this.G=-1;for(var a=this.aa().reset();a.advance();){var b=String(a.get("from"));var c=a.get("to");c=null===c||$.D(c)?null:String(c);var d=$.N(a.get("weight"));var e=!b.length;var f=null!==c&&!c.length;$.ea(d)&&0<d&&!e&&!f&&(b=fS(this,b),e=fS(this,c),c=b,b=e,e=this.aa().la(),this.D[e]={type:b?gS:uS,Si:e,from:c,yf:b,weight:d},c.xM+=d,b?(c.gy.push(this.D[e]),c.Z1.push(d),c.kD.push(b),b.yL+=d,b.E0.push(d),b.DG.push(c),b.Rx.push(this.D[e]),
c.level>=b.level&&(b.level=c.level+1,dS(this,b)),b.level>this.G&&(this.G=b.level)):(c.FF+=d,c.VZ.push(d)))}this.g=[];this.ta=!0;for(var h in this.qf)d=this.qf[h],d.weight=Math.max(d.yL,d.xM),a=d.kD.length+d.VZ.length,this.ta&&!a&&(d.level=this.G),d.DG.length&&a&&(d.qQ=d.yL!=d.xM),a=d.level,this.g[a]||(this.g[a]={qf:[],weight:0,top:window.NaN}),a=this.g[a],a.qf.push(d),a.weight+=d.weight;for(d=h=0;d<this.g.length;d++)for(a=this.g[d],c=0;c<a.qf.length;c++)a.qf[c].id=h++;this.u(4);$.Sq(this,"sankey",
"data")}};$.g.pj=function(){return!this.aa().Gb()};$.g.Se=function(){return[]};$.g.cp=function(){this.Va().Y()};$.g.kF=function(a,b){if(!this.U||b)this.U=new $.Rv;var c={};hS(c,a);if(a.type!=eS){var d=this.aa();d.select(a.Si);this.U.xg(d)}else this.U.xg(null);return $.Bu(this.U,c)};$.g.TB=function(a){this.tl||(this.tl=new $.Rv);var b={};a=a.element;hS(b,a);if(a.type!=eS){var c=this.aa();c.select(a.Si);this.tl.xg(c)}else this.tl.xg(null);return $.Bu(this.tl,b)};
$.g.Hea=function(a,b){return{x:a[b].x,y:a[b].y}};$.g.sW=function(a){return{x:(a.left+a.right)/2,y:a.topCenter}};$.g.ng=function(a){var b=a.domTarget,c=b.tag;if(c){var d=c.element.type;d==eS?(d=this.f.Va(),lS(this,b,$.fo,"left-bottom","right-bottom",this.Hea)):d==gS?(d=this.b.Va(),mS(this,b,$.fo)):(d=this.j.Va(),nS(this,b,$.fo));$.$v(d,a.clientX,a.clientY,this.TB(c))}else this.Va().Oc()};
$.g.Cg=function(a){a=a.domTarget;var b=a.tag;this.Va().Oc();b&&(b=b.element.type,b==eS?lS(this,a,$.Vl,"center-bottom","center-bottom",this.sW):b==gS?mS(this,a,$.Vl):nS(this,a,$.Vl))};$.g.lR=function(a){var b=[];$.X(a,8192)&&b.push("appearance");$.X(a,4096)&&(a=a.target.Oa()==eS,b.push(a?"nodelabels":"flowlabels"));$.Rq(this,"sankey",b,1)};$.g.uK=function(a){this.j||(this.j=new bS(this,uS),$.W(this,"dropoff",this.j),this.j.pg(),$.L(this.j,this.lR,this));return $.n(a)?(this.j.K(a),this):this.j};
$.g.KK=function(a){this.b||(this.b=new bS(this,gS),$.W(this,"flow",this.b),this.b.pg(),$.L(this.b,this.lR,this));return $.n(a)?(this.b.K(a),this):this.b};$.g.node=function(a){this.f||(this.f=new bS(this,eS),$.W(this,"node",this.f),this.f.pg(),$.L(this.f,this.lR,this));return $.n(a)?(this.f.K(a),this):this.f};
$.g.cc=function(a){if($.K(a,$.ls))return this.Ic($.ls,a),this;if($.K(a,$.is))return this.Ic($.is,a),this;$.D(a)&&"range"==a.type?this.Ic($.ls):($.D(a)||null==this.Da)&&this.Ic($.is);return $.n(a)?(this.Da.K(a),this):this.Da};$.g.Ic=function(a,b){if($.K(this.Da,a))b&&this.Da.K(b);else{var c=!!this.Da;$.md(this.Da);this.Da=new a;$.W(this,"palette",this.Da);this.Da.hq();b&&this.Da.K(b);$.L(this.Da,this.Gf,this);c&&$.Qq(this,"sankey","appearance",1)}};
$.g.Gf=function(a){$.X(a,2)&&$.Qq(this,"sankey","appearance",1)};$.g.we=function(a){var b=a.element;a=a.element.type;var c=this.cc();return a==eS?{id:b.id,name:b.name,sourceColor:c.nc(b.id),conflict:b.qQ}:a==gS?{from:b.from.name,to:b.yf.name,sourceColor:c.nc(b.from.id)}:{from:b.from.name,sourceColor:c.nc(b.from.id)}};var eS=0,gS=1,uS=2,lfa={0:"node",1:"flow",2:"dropoff"};$.g=cS.prototype;$.g.NP=function(a,b){return this.OP(a.from,b.from)};$.g.PP=function(a,b){return this.OP(a.yf,b.yf)};
$.g.OP=function(a,b){return a.pe-b.pe};$.g.lT=function(a,b){return function(c){return a*(1-c)+b*c}};
$.g.Ui=function(a){if(!this.nf()){this.nb();this.va||(this.va=this.Ma.Md(),this.va.zIndex(30),this.node(),this.KK(),this.uK());if(this.J(4)){this.va.Ei();this.f.labels().u(2);this.b.labels().u(2);this.j.labels().u(2);this.N=[];this.ca=[];this.O=[];this.ga=[];var b=this.i("nodePadding"),c=this.i("nodeWidth");if(this.g.length){var d=this.g.length;var e=a.width/d;c=$.M(c,e);e=.3*c}else c=e=d=0;var f,h=[];for(f=0;f<this.g.length;f++){var k=this.g[f];var l=k.qf;var m=l[l.length-1].FF?e:0;l=(a.height-m-
b*(l.length-1))/k.weight;h.push(l)}this.ka=Math.min.apply(null,h);b=(a.width-c)/(d-1);for(f=0;f<this.g.length;f++)for(k=this.g[f],l=k.qf,k=0;k<l.length;k++)d=l[k],d.gj=a.left+d.level*b,d.hj=d.gj+c,d.pe=a.top+k,d.Xe=d.pe+d.weight*this.ka;for(var p in this.D)l=this.D[p],l.height=l.weight*this.ka;pS(this,a);l=1;for(f=32;0<f;--f)l*=.99,nfa(this,l),pS(this,a),mfa(this,l),pS(this,a);for(v in this.qf)d=this.qf[v],d.gy.sort(this.PP),d.Rx.sort(this.NP);for(v in this.qf){d=this.qf[v];var q=b=d.pe;for(f=0;f<
d.gy.length;f++)l=d.gy[f],l.pe=q+l.height/2,q+=l.height;for(f=0;f<d.Rx.length;f++)l=d.Rx[f],l.Xe=b+l.height/2,b+=l.height}for(v in this.qf)d=this.qf[v],k=this.va.path(),k.zIndex(3),this.ca.push(k),k.tag={element:d},d.path=k,d.gj=$.R($.Gm(d.gj,4),1),d.pe=$.R($.Gm(d.pe,4),1),d.hj=$.R($.Gm(d.hj,4),1),d.Xe=$.R($.Gm(d.Xe,4),1),k.moveTo(d.gj,d.pe).lineTo(d.hj,d.pe).lineTo(d.hj,d.Xe).lineTo(d.gj,d.Xe).lineTo(d.gj,d.pe).close();d=this.i("curveFactor");for(p in this.D)if(l=this.D[p],l.yf){k=this.va.path();
k.zIndex(1);this.O.push(k);k.tag={element:l};l.path=k;a=l.from.hj;f=l.yf.gj;q=l.pe;b=l.Xe;m=this.lT(a,f);h=m(d);m=m(1-d);var r=l.height/2;l.left=a;l.right=f;l.topCenter=(q+b)/2-r;l.leftTop={x:a,y:q-r};l.rightTop={x:f,y:b-r};var t=q-r,u=b-r;q+=r;b+=r;k.moveTo(a,t).pk(h,t,m,u,f,u).lineTo(f,b).pk(m,b,h,q,a,q).lineTo(a,t);3>l.height&&(k=this.va.path(),k.zIndex(2),this.ga.push(k),k.fill($.Ql).stroke($.Ql,3),k.moveTo(a,t).pk(h,t,m,u,f,u).lineTo(f,b).pk(m,b,h,q,a,q).lineTo(a,t),k.tag={element:l})}else b=
l.from.FF*this.ka,m=Math.min(b,c/4),a=l.from.hj,f=a+m,h=l.from.Xe,b=h-b,k=this.va.path(),k.zIndex(1),this.N.push(k),k.tag={element:l},l.path=k,l.eia=f,l.fia=h,k.moveTo(a,b).arcTo(m,m,-90,90),b+m<h&&k.lineTo(f,h),k.lineTo((a+f)/2,h+e).lineTo(a,h).close();$.Rq(this,"sankey",["appearance","nodelabels","flowlabels"]);this.I(4)}$.Tq(this,"sankey","appearance")&&(qS(this,this.ca,this.f),qS(this,this.O,this.b),qS(this,this.N,this.j),$.Sq(this,"sankey","appearance"));if($.Tq(this,"sankey","nodelabels")){l=
this.f.labels();l.clear().P(this.va).zIndex(3);for(var v in this.qf)d=this.qf[v],a=d.id,c=this.kF(d,!0),e=iS(this,d,$.Vl),d.label=l.add(c,e,a),this.Zd(this.f,d,$.Vl);l.Y();this.f.dH();$.Sq(this,"sankey","nodelabels")}if($.Tq(this,"sankey","flowlabels")){v=this.b.labels();f=this.j.labels();v.clear().P(this.va).zIndex(3);f.clear().P(this.va).zIndex(3);for(p in this.D)l=this.D[p],a=$.N(p),d=l.yf,c=this.kF(l,!0),d?(e={value:this.sW(l)},l.label=v.add(c,e,a),l.label.Ok("center-bottom")):(e={value:{x:l.eia,
y:l.fia}},l.label=f.add(c,e,a),l.label.Ok("left-center")),this.Zd(d?this.b:this.j,l,$.Vl);v.Y();f.Y();this.b.dH();this.j.dH();$.Sq(this,"sankey","flowlabels")}}};
$.g.Zd=function(a,b,c){var d=b.label;if(d){var e=this.aa();a.Oa()==eS?e.reset():e.select(b.Si);b=e.get("normal");b=$.n(b)?b.label:void 0;var f=e.get("hovered");f=$.n(f)?f.label:void 0;b=$.Jo(b,e.get("label"),null);e=$.Jo(f,e.get("hoverLabel"),null);e=c?e:null;f=c?a.kb().labels():null;var h=a.Ra().labels();c=c?a.kb().labels().ma:null;var k=a.Ra().labels().ma,l=e&&$.n(e.enabled)?e.enabled:null,m=b&&$.n(b.enabled)?b.enabled:null,p=f&&null!==f.enabled()?f.enabled():null,q=h&&null!==h.enabled()?h.enabled():
null;a=!1;null!=l?a=l:null!=m?a=m:null!=p?a=p:a=q;a?(d.enabled(!0),d.state("labelOwnSettings",d.La,0),d.state("pointState",e,1),d.state("pointNormal",b,2),d.state("elementState",f,3),d.state("elementNormal",h,4),d.state("elementStateTheme",c,5),d.state("auto",d.yd,6),d.state("elementNormalTheme",k,7)):d.enabled(!1);d.Y()}};$.g.wt=function(){return[this]};$.g.SF=function(){return["from","to","weight"]};
$.g.F=function(){var a=cS.B.F.call(this);a.data=this.data().F();a.tooltip=this.Va().F();a.palette=this.cc().F();a.dropoff=this.uK().F();a.flow=this.KK().F();a.node=this.node().F();$.uq(this,tS,a);return{chart:a}};$.g.X=function(a,b){cS.B.X.call(this,a,b);"data"in a&&this.data(a.data);this.cc(a.palette);"tooltip"in a&&this.Va().ia(!!b,a.tooltip);"dropoff"in a&&this.uK().ia(!!b,a.dropoff);"flow"in a&&this.KK().ia(!!b,a.flow);"node"in a&&this.node().ia(!!b,a.node);$.mq(this,tS,a,b)};
$.g.R=function(){$.od(this.Da,this.j,this.b,this.f,this.cb,this.N,this.ca,this.O,this.ga,this.na,this.kd);this.cb=this.f=this.b=this.j=this.Da=null;this.N.length=0;this.ca.length=0;this.O.length=0;this.ga.length=0;this.Vd=this.kd=this.na=null;cS.B.R.call(this)};var vS=cS.prototype;vS.getType=vS.Oa;vS.data=vS.data;vS.noData=vS.Km;vS.tooltip=vS.Va;vS.dropoff=vS.uK;vS.flow=vS.KK;vS.node=vS.node;vS.palette=vS.cc;$.zp.sankey=rS;$.F("anychart.sankey",rS);}).call(this,$)}
